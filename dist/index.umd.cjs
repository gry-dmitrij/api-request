(function(o,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis<"u"?globalThis:o||self,n(o["api-request"]={}))})(this,function(o){"use strict";var E=Object.defineProperty;var N=(o,n,h)=>n in o?E(o,n,{enumerable:!0,configurable:!0,writable:!0,value:h}):o[n]=h;var l=(o,n,h)=>N(o,typeof n!="symbol"?n+"":n,h);class n extends Error{constructor({message:t,status:s,statusText:r,response:a}){super(t);l(this,"_status");l(this,"_statusText");l(this,"_response");this._status=s,this._statusText=r,this._response=a}get status(){return this._status}get statusText(){return this._statusText}get response(){return this._response}}const h={get:"get",head:"head"},T={post:"post",put:"put",delete:"delete"},p={...T,...h},R=new Set([...Object.values(h),...Object.values(h).map(u=>u.toUpperCase())]),w=new Set([...Object.values(p),...Object.values(p).map(u=>u.toUpperCase())]),y=u=>R.has(u),f=u=>w.has(u);class q{static FormDataForNoBodyMethods(){return`Wrong params. FormData cannot be included in queries [${Object.values(h).reduce((t,s,r)=>t+(r>0?`, ${s}`:s),"")}]`}static WrongTypeResponse(){return"Wrong type response"}}class c{constructor({data:e,status:t,statusText:s,headers:r}){l(this,"_data");l(this,"_status");l(this,"_statusText");l(this,"_headers");this._data=e,this._status=t,this._statusText=s,this._headers=r}get data(){return this._data}get status(){return this._status}get statusText(){return this._statusText}get headers(){return this._headers}}const x="Authorization";class A{constructor(){l(this,"_token")}_headersHas(e,t){const s=t.toLowerCase();return e instanceof Headers?e.has(t):Array.isArray(e)?!!e.find(r=>r[0].toLowerCase()===s):!!Object.keys(e).find(r=>r.toLowerCase()===s)}_addHeader(e,t,s){Array.isArray(e)?e.push([t,s]):e instanceof Headers?e.append(t,s):e[t]=s}_addToken(e){this._token!=null&&this._addHeader(e,x,this._token)}_addTokenIfNoExist(e){this._headersHas(e,x)||this._addToken(e)}_addHeaderIfNoExist(e,t,s){this._headersHas(e,t)||this._addHeader(e,t,s)}_createUrl(e,t,s){const r=new URLSearchParams;if(y(e)){if(s instanceof FormData)throw new n({message:q.FormDataForNoBodyMethods(),status:0,statusText:""});s&&Object.entries(s).forEach(([a,d])=>{(Array.isArray(d)?d:[d]).forEach(_=>{(typeof _=="string"||typeof _=="number"||typeof _=="boolean")&&r.append(a,_.toString())})})}return r.size?`${t}?${r.toString()}`:t}getToken(){return this._token}setToken(e){this._token=e}}class H extends A{_createRequestInit(e,t,s){const r=t&&(t instanceof FormData||t instanceof ReadableStream)?t:JSON.stringify(t),a={method:e.toUpperCase(),headers:new Headers,...s,...!y(e)&&{body:r}};return this._addTokenIfNoExist(a.headers),a}async _getDataFromResponse(e,t){const s=t==null?void 0:t.responseType;let r="";switch(s){case"blob":case"json":r=await e[s]();break;case"arraybuffer":r=await e.arrayBuffer();break;case"text":default:{const a=await e.text();if(r=a,(t==null?void 0:t.responseType)==null)try{r=JSON.parse(a)}catch{r=a}}}if(!e.ok)throw new n({message:e.statusText,status:e.status,statusText:e.statusText,response:new c({data:r,status:e.status,statusText:e.statusText,headers:e.headers})});return Promise.resolve(r)}async _fetch(e,t){const s=await fetch(e);try{const r=await this._getDataFromResponse(s,t);return new c({data:r,status:s.status,statusText:s.statusText,headers:s.headers})}catch(r){throw r instanceof n?r:new n({message:q.WrongTypeResponse(),status:s.status,statusText:s.statusText})}}request(e,t,s,r){const a=this._createUrl(e,t,s),d=this._createRequestInit(e,s,r),i=new Request(a,d);return this._fetch(i,r)}}class b extends A{_addHeaders(e,t){let s=t==null?void 0:t.headers;if(this._token!=null&&(s||(s=new Headers),this._addToken(s)),!s)return;const r=Array.isArray(s)?s.values():s instanceof Headers?s.entries():Object.entries(s);for(const[a,d]of r)e.setRequestHeader(a,d)}_createHeaders(e){const t=new Headers;return e.trim().split(/[\r\n]+/).forEach(r=>{const a=r.split(": "),d=a.shift(),i=a.join(": ");d&&t.append(d,i)}),t}_formatResponse(e){let t=e.response;if(e.responseType===""&&typeof t=="string")try{t=JSON.parse(t)}catch{t=e.response}return t}_createError(e){return new n({message:e.statusText,status:e.status,statusText:e.statusText,response:new c({data:this._formatResponse(e),status:e.status,statusText:e.statusText,headers:this._createHeaders(e.getAllResponseHeaders())})})}_onload(e,t,s){e.onload=()=>{e.status>=200&&e.status<=299?t(new c({data:this._formatResponse(e),status:e.status,statusText:e.statusText,headers:this._createHeaders(e.getAllResponseHeaders())})):s(this._createError(e))}}_onerror(e,t){e.onerror=()=>{t(this._createError(e))}}_onprogress(e,t){e.upload.onprogress=s=>{var r;(r=t==null?void 0:t.onUploadProgress)==null||r.call(t,{loaded:s.loaded,total:s.total,...s.total?{progress:s.loaded/s.total}:void 0})},e.onprogress=s=>{var r;(r=t==null?void 0:t.onDownloadProgress)==null||r.call(t,{loaded:s.loaded,total:s.total,...s.total?{progress:s.loaded/s.total}:void 0})}}request(e,t,s,r){return new Promise((a,d)=>{const i=new XMLHttpRequest;i.responseType=(r==null?void 0:r.responseType)||"",i.open(e.toUpperCase(),this._createUrl(e,t,s)),this._addHeaders(i,r);const _=s&&(s instanceof FormData?s:JSON.stringify(s));this._onload(i,a,d),this._onerror(i,d),this._onprogress(i,r),i.send(_)})}}class M{static createRequestAdapter(e,t){return t!=null&&t.onUploadProgress||t!=null&&t.onDownloadProgress?new b:new H}}class k{constructor(){l(this,"_token")}request(e,t,s,r){const a=M.createRequestAdapter(e,r);return this._token&&a.setToken(this._token),a.request(e,t,s,r)}setToken(e){this._token=e}}o.ApiError=n,o.ApiResponse=c,o.BodyRequestMethod=T,o.NoBodyMethods=R,o.NoBodyRequestMethod=h,o.RequestMethod=p,o.RequestMethods=w,o.default=k,o.isNoBodyRequestMethod=y,o.isRequestMethod=f,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
