(function(o,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis<"u"?globalThis:o||self,n(o["api-request"]={}))})(this,function(o){"use strict";var N=Object.defineProperty;var E=(o,n,h)=>n in o?N(o,n,{enumerable:!0,configurable:!0,writable:!0,value:h}):o[n]=h;var l=(o,n,h)=>E(o,typeof n!="symbol"?n+"":n,h);class n extends Error{constructor({message:t,status:s,statusText:r,response:a}){super(t);l(this,"_status");l(this,"_statusText");l(this,"_response");this._status=s,this._statusText=r,this._response=a}get status(){return this._status}get statusText(){return this._statusText}get response(){return this._response}}const h={get:"get",head:"head"},y={post:"post",put:"put",delete:"delete"},c={...y,...h},T=new Set([...Object.values(h),...Object.values(h).map(u=>u.toUpperCase())]),R=new Set([...Object.values(c),...Object.values(c).map(u=>u.toUpperCase())]),p=u=>T.has(u),A=u=>R.has(u);class w{static FormDataForNoBodyMethods(){return`Wrong params. FormData cannot be included in queries [${Object.values(h).reduce((t,s,r)=>t+(r>0?`, ${s}`:s),"")}]`}static WrongTypeResponse(){return"Wrong type response"}}class _{constructor({data:e,status:t,statusText:s,headers:r}){l(this,"_data");l(this,"_status");l(this,"_statusText");l(this,"_headers");this._data=e,this._status=t,this._statusText=s,this._headers=r}get data(){return this._data}get status(){return this._status}get statusText(){return this._statusText}get headers(){return this._headers}}const q="Authorization";class x{constructor(){l(this,"_token")}_headersHas(e,t){const s=t.toLowerCase();return e instanceof Headers?e.has(t):Array.isArray(e)?!!e.find(r=>r[0].toLowerCase()===s):!!Object.keys(e).find(r=>r.toLowerCase()===s)}_addHeader(e,t,s){Array.isArray(e)?e.push([t,s]):e instanceof Headers?e.append(t,s):e[t]=s}_addToken(e){this._token!=null&&this._addHeader(e,q,this._token)}_addTokenIfNoExist(e){this._headersHas(e,q)||this._addToken(e)}_addHeaderIfNoExist(e,t,s){this._headersHas(e,t)||this._addHeader(e,t,s)}_createUrl(e,t,s){const r=new URLSearchParams;if(p(e)){if(s instanceof FormData)throw new n({message:w.FormDataForNoBodyMethods(),status:0,statusText:""});s&&Object.entries(s).forEach(([a,d])=>{(typeof d=="string"||typeof d=="number"||typeof d=="boolean")&&r.append(a,d.toString())})}return r.size?`${t}?${r.toString()}`:t}getToken(){return this._token}setToken(e){this._token=e}}class H extends x{_createRequestInit(e,t,s){const r=t&&t instanceof FormData?t:JSON.stringify(t),a={method:e.toUpperCase(),headers:new Headers,...s,...!p(e)&&{body:r}};return this._addTokenIfNoExist(a.headers),a}async _getDataFromResponse(e,t){const s=t==null?void 0:t.responseType;let r="";switch(s){case"blob":case"json":r=await e[s]();break;case"arraybuffer":r=await e.arrayBuffer();break;case"text":default:{const a=await e.text();if(r=a,(t==null?void 0:t.responseType)==null)try{r=JSON.parse(a)}catch{r=a}}}if(!e.ok)throw new n({message:e.statusText,status:e.status,statusText:e.statusText,response:new _({data:r,status:e.status,statusText:e.statusText,headers:e.headers})});return Promise.resolve(r)}async _fetch(e,t){const s=await fetch(e);try{const r=await this._getDataFromResponse(s,t);return new _({data:r,status:s.status,statusText:s.statusText,headers:s.headers})}catch(r){throw r instanceof n?r:new n({message:w.WrongTypeResponse(),status:s.status,statusText:s.statusText})}}request(e,t,s,r){const a=this._createUrl(e,t,s),d=this._createRequestInit(e,s,r),i=new Request(a,d);return this._fetch(i,r)}}class b extends x{_addHeaders(e,t){let s=t==null?void 0:t.headers;if(this._token!=null&&(s||(s=new Headers),this._addToken(s)),!s)return;const r=Array.isArray(s)?s.values():s instanceof Headers?s.entries():Object.entries(s);for(const[a,d]of r)e.setRequestHeader(a,d)}_createHeaders(e){const t=new Headers;return e.trim().split(/[\r\n]+/).forEach(r=>{const a=r.split(": "),d=a.shift(),i=a.join(": ");d&&t.append(d,i)}),t}_formatResponse(e){let t=e.response;if(e.responseType===""&&typeof t=="string")try{t=JSON.parse(t)}catch{t=e.response}return t}_createError(e){return new n({message:e.statusText,status:e.status,statusText:e.statusText,response:new _({data:this._formatResponse(e),status:e.status,statusText:e.statusText,headers:this._createHeaders(e.getAllResponseHeaders())})})}_onload(e,t,s){e.onload=()=>{e.status>=200&&e.status<=299?t(new _({data:this._formatResponse(e),status:e.status,statusText:e.statusText,headers:this._createHeaders(e.getAllResponseHeaders())})):s(this._createError(e))}}_onerror(e,t){e.onerror=()=>{t(this._createError(e))}}_onprogress(e,t){e.upload.onprogress=s=>{var r;(r=t==null?void 0:t.onUploadProgress)==null||r.call(t,{loaded:s.loaded,total:s.total,...s.total?{progress:s.loaded/s.total}:void 0})},e.onprogress=s=>{var r;(r=t==null?void 0:t.onDownloadProgress)==null||r.call(t,{loaded:s.loaded,total:s.total,...s.total?{progress:s.loaded/s.total}:void 0})}}request(e,t,s,r){return new Promise((a,d)=>{const i=new XMLHttpRequest;i.responseType=(r==null?void 0:r.responseType)||"",i.open(e.toUpperCase(),this._createUrl(e,t,s)),this._addHeaders(i,r);const k=s&&(s instanceof FormData?s:JSON.stringify(s));this._onload(i,a,d),this._onerror(i,d),this._onprogress(i,r),i.send(k)})}}class f{static createRequestAdapter(e,t){return t!=null&&t.onUploadProgress||t!=null&&t.onDownloadProgress?new b:new H}}class M{constructor(){l(this,"_token")}request(e,t,s,r){const a=f.createRequestAdapter(e,r);return this._token&&a.setToken(this._token),a.request(e,t,s,r)}setToken(e){this._token=e}}o.ApiError=n,o.ApiResponse=_,o.BodyRequestMethod=y,o.NoBodyMethods=T,o.NoBodyRequestMethod=h,o.RequestMethod=c,o.RequestMethods=R,o.default=M,o.isNoBodyRequestMethod=p,o.isRequestMethod=A,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
